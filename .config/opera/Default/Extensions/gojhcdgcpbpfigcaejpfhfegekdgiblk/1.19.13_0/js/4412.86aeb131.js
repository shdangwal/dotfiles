"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[4412],{33668:function(t,e,s){s.d(e,{Z:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-row overflow-x-auto rtl-space-x-reverse space-x-4"},t._l(t.percentageValues,(function({label:s,divisor:i}){return e("button",{key:s,staticClass:"border font-bold px-2 py-1 rounded-md text-brand-primary text-sm w-14",class:[{"border-brand-primary bg-brand-primary bg-opacity-5":s===t.selected,"border-black border-opacity-20 bg-gray":s!==t.selected},`t-perc-btn t-perc-btn-${s}`],on:{click:function(e){return t.select({label:s,divisor:i})}}},[e("span",1===i?[t._v(t._s(t.$t("general.max")))]:[t._v(t._s(t.localizePercentage(s)))])])})),0)},a=[],r=s(70794),n=s(10359),o=s(37426),l={name:"PercentageButtons",props:{token:{default:void 0,type:Object},value:{default:void 0,type:[r.Z,Number,String]}},data(){return{calculatedAmount:null,percentageValues:[{divisor:4,label:"25"},{divisor:2,label:"50"},{divisor:1,label:"100"}],selected:null}},watch:{value(){this.value!==this.calculatedAmount&&(this.selected=null)}},methods:{calculateAmount(t){const e=Object.assign({},this.token,{balance:new r.Z(this.token.balance).dividedBy(t)});this.calculatedAmount=o.Z.tokenDecimal(e)||(0,r.Z)(0),this.$emit("change",this.calculatedAmount)},localizePercentage:n.Z.localizePercentage,select({label:t,divisor:e}){this.selected=t,this.calculateAmount(e)}}},p=l,c=s(1001),h=(0,c.Z)(p,i,a,!1,null,null,null),u=h.exports},55062:function(t,e,s){s.r(e),s.d(e,{default:function(){return rt}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pb-8"},[e("div",{staticClass:"flex flex-col flex-grow h-full"},[e("top-bar",{attrs:{"test-parent-name":"swap_view",title:t.$t("general.swap")}}),e("div",{key:t.timesSwappableTokensUpdated,staticClass:"flex flex-col flex-grow justify-start mt-4 mx-4"},[e("swap-input",{staticClass:"mb-4 t-swap-from_balance",class:[{"pointer-events-none":t.isLoading||!!t.currentPendingApprovalHash}],attrs:{balance:t.fromBalance,type:"from"},model:{value:t.from,callback:function(e){t.from=e},expression:"from"}}),e("div",{staticClass:"flex flex-col items-center"},[e("horizontal-divider",{staticClass:"my-3"},[e("button",{staticClass:"bg-brand-primary bg-opacity-10 flex-shrink-0 h-10 rounded-full t-swap-switch w-10",class:{"cursor-not-allowed":t.disableTokenSwitch||!!t.currentPendingApprovalHash},attrs:{disabled:t.disableTokenSwitch,title:t.disableTokenSwitch?t.$t("general.youDontOwnAny",{asset:t.toSymbol}):""},on:{click:t.switchTokens,mouseleave:function(e){t.exchangeHover=!1},mouseover:function(e){t.exchangeHover=!0}}},[e("i",{staticClass:"align-bottom icon text-brand-primary",class:{"icon-exchange":t.exchangeHover,"icon-swap_arrow":!t.exchangeHover}})])])],1),e("swap-input",{staticClass:"t-swap-to_balance",class:[{"pointer-events-none":t.isLoading||!!t.currentPendingApprovalHash}],attrs:{balance:t.toBalance,"read-only":"",type:"to"},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}}),e("swap-info",{class:[{"pointer-events-none":t.isLoading}],attrs:{conversion:t.conversion,error:t.generalTxError,price:t.price,"show-info":!(!t.from.value||!t.to.value),"to-token-amount":t.toTokenAmount},on:{changeSlippage:t.changeSlippage,refreshTx:t.refreshTx}})],1),t.currentPendingApprovalHash?e("div",[e("div",[e("div",{staticClass:"bg-dark-N16-op50 m-4 mb-4 px-6 py-4 rounded-lg text-dark-N77 text-sm"},[e("i18n",{attrs:{path:"views.swapView.pendingApproval"},scopedSlots:t._u([{key:"pendingApprovalLink",fn:function(){return[e("a",{staticClass:"cursor-pointer text-brand-primary",on:{click:function(e){return t.openApprovalDetails()}}},[t._v(" "+t._s(t.$t("views.swapView.pendingApprovalLinkTitle"))+" ")])]},proxy:!0}],null,!1,2148050931)})],1)])]):t._e(),e("p",{staticClass:"text-2xs text-center text-dark-N77"},[t._v(" "+t._s(t.$t("views.swapView.providedByOpera"))+" ")]),e("primary-button",{staticClass:"mt-4 mx-4 relative t-swap-swap",attrs:{disabled:t.invalidStateOrPendingApproval,loading:t.isLoading||!!t.currentPendingApprovalHash,title:t.primaryButtonText},on:{click:function(e){t.isApproveRequired?t.getApprove():t.getSwap()}}},[e("lottie-component",{staticClass:"absolute",attrs:{src:"loader_button.json"}})],1)],1)])},a=[],r=(s(57658),s(47812)),n=s(79317);const o=(t,e)=>{let s;return function(...i){return void 0!==s&&e||t.apply(this,i),clearTimeout(s),s=setTimeout((()=>t.apply(this,i)),e),s}};var l,p=s(46686),c=s(70794),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"border-opacity-10 line-divider w-full"},[t._t("default")],2)},u=[],d={name:"HorizontalDivider"},g=d,m=s(1001),f=(0,m.Z)(g,h,u,!1,null,"0c0ab06d",null),v=f.exports,w=s(76501),k=s(25778),x=s(69790),b=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"mt-8 w-full"},[t.showInfo||t.error?t.error&&!t.insufficientFunds?e("div",{staticClass:"bg-dark-N16 flex flex-col font-semibold gap-3.5 h-60 items-center justify-center rounded-3xl text-center text-spectrum-red text-xs"},[e("img",{staticClass:"h-14 mb-0.5 w-14",attrs:{src:s(571)}}),e("div",[t._v(" "+t._s(t.$t("errors.generic.somethingWentWrongShort"))+" ")]),e("div",{staticClass:"cursor-pointer text-accent underline",on:{click:function(e){return t.$emit("refreshTx")}}},[t._v(" "+t._s(t.$t("general.refresh"))+" ")])]):e("div",[e("div",{staticClass:"bg-dark-N16-op50 flex items-center justify-center px-6 py-4 rounded-4xl"},[e("div",{staticClass:"max-w-full text-sm"},[e("p",{staticClass:"max-w-fit truncate"},[e("span",[t._v(t._s(t.conversion)+" ")]),e("span",{staticClass:"text-dark-N77"},[t._v(t._s(t.price))])])])]),e("div",{staticClass:"bg-dark-N16-op50 mb-3 mt-6 px-6 py-4 rounded-xl"},[e("div",{staticClass:"flex items-center justify-between"},[e("div",[e("div",{staticClass:"text-[13px] text-dark-N77"},[t._v(" "+t._s(t.$t("components.swapInfo.slippageTolerance"))+" ")]),t.showSlippageSettings?e("p",{staticClass:"text-dark-N77-op50 text-xs"},[t._v(" "+t._s(t.$t("components.swapInfo.selectSuggested"))+" ")]):e("div",{staticClass:"mt-1"},[t._v(" "+t._s(t.localizePercentage(t.slippage.toString()))+" ")])]),e("div",{staticClass:"flex items-center"},[e("i",{staticClass:"cursor-pointer icon-trans",class:[{"text-dark-N77":!t.showSlippageSettings,"text-accent":t.showSlippageSettings}],on:{click:function(e){t.showSlippageSettings=!t.showSlippageSettings}}})])]),t.showSlippageSettings?e("div",[e("slippage-buttons",{staticClass:"mt-5"}),t.errorStage&&!t.isSafeSlippage?e("div",{staticClass:"mt-5 pb-5 pt-4 px-6 rounded-lg",class:[{"text-red bg-red-10":[t.SlippageErrorStages.Insufficient,t.SlippageErrorStages.Excessive].includes(t.errorStage),"text-orange bg-orange-10":[t.SlippageErrorStages.TxMayFail,t.SlippageErrorStages.BadRate].includes(t.errorStage),"text-yellow bg-yellow-10":[t.SlippageErrorStages.ModerateRate].includes(t.errorStage)}]},[t._v(" "+t._s(t.errorList.get(t.errorStage))+" ")]):t._e()],1):t._e()]),t.isValidSlippage?e("div",{staticClass:"bg-dark-N16-op50 flex items-center justify-between mb-3 mt-1 px-6 py-4 rounded-xl"},[e("div",[e("div",{staticClass:"text-dark-N77 text-xs"},[t._v(" "+t._s(t.$t("components.swapInfo.minimumReceive",{slippage:t.localizePercentage(t.slippage.toString())}))+" ")]),e("div",{staticClass:"mt-1"},[t._v(" "+t._s(t.formatNumber(t.minAmountReceived))+" "+t._s(t.currentSwap.toToken.symbol)+" ")])])]):t._e()]):e("div",{staticClass:"border-2 border-dark-N16 flex h-56 items-center justify-center rounded-3xl"},[e("span",{staticClass:"opacity-50 text-base text-dark-N77"},[t._v(t._s(t.$t("components.swapInfo.enterSwapAmount")))])])])},y=[];(function(t){t[t["Insufficient"]=1]="Insufficient",t[t["TxMayFail"]=2]="TxMayFail",t[t["ModerateRate"]=3]="ModerateRate",t[t["BadRate"]=4]="BadRate",t[t["Excessive"]=5]="Excessive"})(l||(l={}));var S=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"flex flex-row justify-between overflow-x-auto rtl-space-x-reverse space-x-2 t-slippage_buttons"},[t._l(t.slippageOptions,(function(s){return e("button",{key:s,staticClass:"border flex-1 font-bold leading-6 mb-1 py-1 rounded-md text-brand-primary text-sm w-11",class:[{"border-brand-primary bg-brand-primary bg-opacity-5":s===t.slippage&&!t.showInput,"border-black border-opacity-20 bg-gray":s!==t.slippage||t.showInput}],on:{click:function(e){return t.select(s)}}},[e("span",[t._v(t._s(t.localizePercentage(s.toString())))])])})),e("div",{staticClass:"flex-1 h-8.5 w-28"},[t.showInput?e("div",{staticClass:"border flex font-bold h-8.5 items-center justify-between mb-1 px-2 py-1 rounded-md text-brand-primary text-sm w-28"},[e("input",{ref:"customSlippageInput",staticClass:"bg-transparent flex-1 t-slippage_buttons-custom_slippage_input text-right w-12",attrs:{type:"string"},domProps:{value:t.slippage},on:{input:t.changeSlippage}}),e("span",{staticClass:"opacity-50 text-dark-N77"},[t._v("%")]),e("div",{staticClass:"flex-1"})]):e("button",{staticClass:"bg-gray border border-black border-opacity-20 font-bold leading-6 mb-1 px-2 py-1 rounded-md text-brand-primary text-sm w-fit",on:{click:t.handleShowInput}},[t._v(" "+t._s(t.$t("general.custom"))+" ")])])],2)},T=[],$=s(20144),_=s(10359),C=$.ZP.extend({name:"SlippageButtons",data(){return{showInput:!1,slippageOptions:this.$store.state.swap.slippageOptions,slippageUpdateTimer:null}},computed:{isValidSlippage(){return this.getIsValidSlippage(this.slippage)},slippage(){return this.$store.getters.slippage},slippageDecimal(){return this.$store.getters.slippageData.slippageDecimal}},methods:{changeSlippage(t){clearTimeout(this.slippageUpdateTimer);const e=this.sanitizeValue(t);e!==this.slippage&&(this.slippageUpdateTimer=window.setTimeout((()=>{this.$store.dispatch("setSlippage",e)}),this.getIsValidSlippage(e)?1e3:0))},getIsValidSlippage(t){return this.$store.getters.isValidSlippage(t)},handleShowInput(){this.showInput=!0,this.$nextTick((()=>{this.$refs.customSlippageInput?.focus()}))},isValidSlippagePattern(t){const e=new RegExp(`^(0|[1-9]\\d{0,1})([\\.\\,]\\d{1,${this.slippageDecimal}})?$`),s=[".",","].some((e=>t.endsWith(e)));return e.test((s?+t:t).toString())},localizePercentage:_.Z.localizePercentage,sanitizeValue({target:t}){let{value:e}=t;e=e?.replace(",",".");const s=new Map([["isTruthy",!!e&&!isNaN(+e)],["isValidSlippage",this.isValidSlippagePattern(e)],["isValidSlippagePercentage",+e>=0||+e<100]]);return[...s.values()].some((t=>!t))&&(e="0",t.value=null),+e},select(t){this.showInput=!1,this.$store.dispatch("setSlippage",t)}}}),A=C,I=(0,m.Z)(A,S,T,!1,null,"f0130492",null),Z=I.exports,P=$.ZP.extend({name:"SwapInfo",components:{SlippageButtons:Z},props:{conversion:{default:"",type:String},error:{default:!1,type:Boolean},price:{default:"",type:String},showInfo:{default:!1,type:Boolean},toTokenAmount:{default:new c.Z(0),type:c.Z}},data(){return{SlippageErrorStages:l,errorStage:void 0,showSlippageSettings:!1,slippageOptions:this.$store.state.swap.slippageOptions}},computed:{currentSwap(){return this.$store.getters.currentSwap},errorIndex(){const{max:t,min:e,slippageOptions:s}=this,{Insufficient:i,TxMayFail:a,ModerateRate:r,BadRate:n,Excessive:o}=l;return new Map([[e,i],[s.at(0),a],[s.at(-1),r],[t+e,n],[100,o]])},errorList(){const{max:t,min:e,slippage:s}=this,{Insufficient:i,TxMayFail:a,ModerateRate:r,BadRate:n,Excessive:o}=l;return new Map([[i,this.$i18n.t("components.swapInfo.minimumSlippageRate",{slippage:this.localizePercentage(e.toString())})],[a,this.$i18n.t("components.swapInfo.yourTransactionMayFail")],[r,this.$i18n.t("components.swapInfo.youMayReceive",{slippage:this.localizePercentage(s.toString())})],[n,this.$i18n.t("components.swapInfo.youMayReceiveAnd",{slippage:this.localizePercentage(s.toString())})],[o,this.$i18n.t("components.swapInfo.maximumSlippageRate",{slippage:this.localizePercentage(t.toString())})]])},insufficientFunds(){return this.$store.getters.txError.insufficientFunds},isSafeSlippage(){return this.slippage>=this.slippageOptions.at(0)&&this.slippage<=1},isValidSlippage(){return this.$store.getters.isValidSlippage()},max(){return this.slippageData.slippageMax},min(){return this.slippageData.slippageMin},minAmountReceived(){return this.toTokenAmount.times(1-this.slippage/100)},slippage(){return this.$store.getters.slippage},slippageData(){return this.$store.getters.slippageData}},watch:{slippage(t){this.errorStage=[...this.errorIndex.entries()].find((([e])=>t<e))?.at(1)}},methods:{formatNumber:_.Z.formatNumber,localizePercentage:_.Z.localizePercentage}}),E=P,N=(0,m.Z)(E,b,y,!1,null,"0b5a8f07",null),B=N.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-full"},[e("div",{staticClass:"flex flex-col items-center"},[e("div",{staticClass:"flex items-end justify-between mb-3 w-full"},[e("div",{staticClass:"bg-dark-N16 cursor-pointer flex items-center justify-center pl-3 pr-4 py-1 rounded-full t-swap_input-show_dialog",on:{click:t.showDialog}},[e("token-icon",{staticClass:"h-7 mr-2 w-7",attrs:{address:t.address,chain:t.chain}}),e("div",{staticClass:"mr-4"},[e("div",{staticClass:"font-bold text-base"},[t._v(t._s(t.name))]),e("div",{staticClass:"font-semibold opacity-50 text-dark-N77 text-sm"},[t._v(" "+t._s(t.chainNameFriendly)+" ")])]),e("i",{staticClass:"icon-chevron_down"})],1),e("div",{staticClass:"grow mb-1 ml-2 mr-5 text-right text-sm"},[e("span",{staticClass:"text-dark-N77-op50"},[t._v(t._s(t.$t("general.balance"))+": ")]),e("span",{staticClass:"text-dark-N77 whitespace-pre-wrap",class:[{"text-accent":!t.readOnly}]},[t._v(t._s(t.fullBalance))])])]),e("div",{staticClass:"flex flex-col justify-center text-center w-full"},[e("input",{staticClass:"bg-neutral-01 focus:text-brand-primary input placeholder:text-white px-5 py-3.5 text-right w-full",class:[{"input-error pr-10":t.error,"cursor-not-allowed placeholder:text-neutral-06":t.readOnly}],attrs:{disabled:t.readOnly,placeholder:t.inputPlaceholder,title:""},domProps:{value:t.value.value},on:{input:function(e){return t.handleValueInput(e)},paste:function(e){return t.handleValueChanged(e)}}})]),t.error?e("div",{staticClass:"mt-2 text-center text-sm text-spectrum-red"},[t._v(" "+t._s(t.error)+" ")]):t._e(),t.readOnly?t._e():e("percentage-buttons",{staticClass:"mt-5",attrs:{token:Object.assign({},t.token,{balance:t.balanceWithoutDecimals}),value:t.value.value},on:{change:t.assignNewAmount}})],1),e("swap-token-dialog",{ref:"dialog",attrs:{type:t.type}})],1)},q=[],V=s(33668),R=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.showing,expression:"showing"}],staticClass:"bg-background bottom-0 fixed left-0 right-0 top-0 z-30"},[e("div",{staticClass:"flex flex-col h-full"},[e("top-bar",{attrs:{"emit-back":"","test-parent-name":"swap_token_dialog",title:t.$t("general.selectAssets")},on:{back:t.close}}),e("div",{staticClass:"px-4"},[e("opera-input",{staticClass:"t-swap_token_dialog-query",attrs:{placeholder:t.$t("general.search"),"prepend-icon":"icon-search text-brand-primary text-opacity-40",round:"",type:"search"},model:{value:t.query,callback:function(e){t.query=e},expression:"query"}})],1),e("div",{staticClass:"h-full overflow-y-scroll pb-4 px-4",on:{scroll:t.onScroll}},[t.loading&&t.query?e("div",{staticClass:"flex flex-1 items-center justify-center w-full"},[e("i",{staticClass:"animate-spin icon-spinner text-xl"})]):t._l(t.filteredTokens,(function(s,i){return e("token-item",{key:i,attrs:{address:s.address,chain:s.chain,disabled:t.isTokenDisabled(s),name:s.name,selectable:!1,symbol:s.symbol,value:s},on:{change:t.itemClicked}})})),e("back-to-top")],2)],1)])},L=[],O=s(72232),z=s(14957),Q=s(8893),j=s(69986),F=s(37426);const H=20;var M={name:"SwapTokenDialog",components:{BackToTop:O.Z,OperaInput:z.Z,TokenItem:Q.Z,TopBar:j.Z},props:{type:{default:"",type:String}},data(){return{callback:null,filteredAssets:[],loading:!1,n:H,query:"",showing:!1}},computed:{currentSwap(){return this.$store.getters.currentSwap},filteredTokens(){return this.query?this.filteredAssets.slice(0,this.n):this.tokens.slice(0,this.n)},ownedTokens(){return this.$store.getters.ownedTokens(n.oZ.VISIBLE)},tokens(){const{swappableTokens:t,swappableTokensFlat:e}=this.$store.getters;if("to"===this.type){const e=this.currentSwap.fromToken?.chain;return e?t[(0,p.fh)(e)]??[]:[]}return e.filter((t=>!!t.balance))}},watch:{query:{handler(t){this.loading=!0,this.filteredAssets=[],t?this.$nextTick((()=>{this.throttle(this.filterList,1e3)(),this.n=H})):this.$nextTick((()=>{this.n=H}))},immediate:!0}},methods:{close(){this.showing=!1},filterList(){const t=this.query.toLowerCase();this.filteredAssets=this.tokens.filter((e=>e.name.toLowerCase().includes(t)||e.symbol.toLowerCase().includes(t)||this.$store.getters.chainNameFriendly(e.chain).toLowerCase().includes(t))),this.loading=!1},isTokenDisabled(t){if(!Object.keys(this.currentSwap).length)return;const e="from"===this.type?"to":"from",s=F.Z.isSameToken(this.currentSwap[`${e}Token`],t);return s||"from"===this.type&&!t.balance},async itemClicked(t){this.loading=!0,this.callback(t),this.showing=!1,this.loading=!1},onScroll(t){const{target:e}=t,s=e.scrollTop+e.clientHeight>=e.scrollHeight-e.clientHeight;s&&(this.n+H<this.tokens.length?this.n+=H:this.n=this.tokens.length-1)},show(t){this.callback=t,this.showing=!0},throttle(t,e){let s,i;return function(...a){const r=Date.now(),n=this;if(i||(i=r),clearTimeout(s),r-i>e)return i=r,t.apply(n,a),void clearTimeout(s);s=setTimeout((()=>{i=Date.now(),s=null,t.apply(n,a)}),e)}}}},U=M,W=(0,m.Z)(U,R,L,!1,null,null,null),G=W.exports,J=s(92266),K={name:"SwapInput",components:{PercentageButtons:V.Z,SwapTokenDialog:G,TokenIcon:J.Z},props:{balance:{default:"",type:c.Z},readOnly:{type:Boolean},type:{default:"",type:String},value:{default:void 0,type:Object}},data(){return{focused:!1,inputPlaceholder:"0.0",token:{}}},computed:{address(){return this.token.address},balanceWithoutDecimals(){const t=this.balance??0;return F.Z.withoutDecimals(t,this.token.decimals)},chain(){return this.token.chain},chainNameFriendly(){if(this.chain)return this.$store.getters.chainNameFriendly(this.chain)},error(){const t="from"===this.type&&this.$store.getters.txError.insufficientFunds;return t&&this.$t("errors.generic.insufficientFunds")},fullBalance(){return this.$store.getters.getFullTokenBalance(this.address,this.token,this.chain,n.oZ.VISIBLE)},maxValue(){return this.readOnly?Number.MAX_SAFE_INTEGER:this.balance},name(){return this.token.name},symbol(){return this.token.symbol}},watch:{value(t){this.token=t.token}},created(){this.token=this.value.token},methods:{assignNewAmount(t){this.$emit("input",{token:this.token,value:t})},formatNumber:_.Z.formatNumber,handleValueChanged(t){const e=this.sanitizeValue(t);this.$emit("input",{token:this.token,value:e})},handleValueInput(t){this.$nextTick((()=>{this.handleValueChanged(t)}))},sanitizeValue(t){let{value:e}=t.target;return t.target.value=F.Z.sanitizeTokenAmountInput(e),e=F.Z.sanitizeTokenAmountInput(e),e},showDialog(){this.$refs.dialog.show((t=>{this.token=t,this.$emit("input",{token:this.token,value:null})}))}}},X=K,Y=(0,m.Z)(X,D,q,!1,null,"5cbd35cb",null),tt=Y.exports,et=s(25108),st={name:"SwapView",components:{HorizontalDivider:v,LottieComponent:w.Z,PrimaryButton:k.Z,SwapInfo:B,SwapInput:tt,TopBar:j.Z},data(){return{approve:null,chain:null,error:null,exchangeHover:!1,from:{token:null,value:null},interval:null,isApprovalsPending:!1,loading:{approve:!1,quote:!1,swap:!1},quote:null,timesSwappableTokensUpdated:0,to:{token:null,value:null}}},computed:{accountAddress(){return this.$store.getters.ethereumAddress},amountWithoutDecimals(){if(!this.from.token||!this.from.value)return null;const t=_.Z.removeExponential(F.Z.withoutDecimals(this.from.value,this.from.token.decimals));return t},canUpdateQuote(){return new c.Z(this.from.value??0).gt(0)&&!this.generalTxError&&this.isValidSlippage},conversion(){const t=this.quote;if(!t)return null;const e=F.Z.withDecimals(t.fromTokenAmount,t.fromToken.decimals),s=t.fromToken.symbol,i=F.Z.withDecimals(t.toTokenAmount,t.toToken.decimals).dividedBy(e),a=t.toToken.symbol;return`1 ${s} ≈ ${_.Z.formatNumber(i)} ${a}`},currentPendingApprovalHash(){return this.$store.getters.currentPendingApprovalHash},currentSwap(){return this.$store.getters.currentSwap},disableTokenSwitch(){if(this.isLoading)return!0;const t=!!this.ownedTokens.find((t=>{let e=t.contract.contract;return e===r.L1&&(e=r.NA),e===this.to.token?.address}));return!t&&(!t||!this.from.value)},fromBalance(){return this.tokenBeingSwapped?F.Z.tokenDecimal(this.tokenBeingSwapped):null},fromSymbol(){return this.from&&this.from.token?this.from.token.symbol:""},generalTxError(){return!!this.error||Object.values(this.$store.getters.txError).some((t=>t))},hasQuoteBasis(){const t=this.to.token?.address??null,e=this.from.token?.address??null,s=this.amountWithoutDecimals;return!!(t&&e&&s)},invalidBalance(){return!this.from.token||(new c.Z(this.fromBalance).isLessThan(new c.Z(this.from.value))||new c.Z(this.fromBalance).isLessThanOrEqualTo(new c.Z(0))||new c.Z(this.from.value).isLessThanOrEqualTo(new c.Z(0)))},invalidStateOrPendingApproval(){return this.isInInvalidState||!!this.currentPendingApprovalHash},isApproveRequired(){return!!this.approve},isInInvalidState(){return this.generalTxError||this.isLoading||this.invalidBalance||!this.quote||!this.$store.getters.networksSupportingSwap||!this.isValidSlippage},isLoading(){return Object.values(this.loading).some((t=>t))},isSwapUnavailable(){return this.isInInvalidState||this.isApprovalsPending||this.isApproveRequired},isValidSlippage(){return this.$store.getters.isValidSlippage()},ownedTokens(){return this.$store.getters.ownedTokens(n.oZ.VISIBLE)},pendingApprovals(){return this.$store.getters.pendingApprovals},price(){const t=this.quote;if(!t)return null;const{getPriceForToken:e}=this.$store.getters,s=_.Z.formatNumber(e(t.fromToken)),i=_.Z.formatNumber(e(t.toToken)),a=[s,i].find((t=>t.gt(0)))??new c.Z(0),r=a.gt(0)?`(${this.localizeCurrency(a)})`:"";return r},primaryButtonText(){return this.currentPendingApprovalHash?this.$t("views.swapView.processingApproval"):this.isLoading?this.$t("views.swapView.fetchingQuotes"):this.$t("general.next")},slippage(){return this.$store.getters.slippage},swappableTokens(){return this.$store.getters.swappableTokens},swapper(){return this.$store.getters.swapper},toBalance(){const t=this.determineTokenAddress(this.to.token),{chain:e}=this.to.token,s=this.$store.getters.getToken(t,e);return s?F.Z.tokenDecimal(s):null},toSymbol(){return this.to&&this.to.token?this.to.token.symbol:""},toTokenAmount(){const t=this.quote;return t?F.Z.withDecimals(this.quote.toTokenAmount,this.quote.toToken.decimals):null},tokenBeingSwapped(){if(!this.from.token)return null;const t=this.determineTokenAddress(this.from.token),{chain:e}=this.from.token;return this.$store.getters.getToken(t,e)}},watch:{chain:{deep:!0,handler(){this.$store.dispatch("setSlippageData",this.chain)}},from:{deep:!0,handler(){this.to.token&&(this.chain=this.from.token.chain,this.$store.dispatch("clearTxError"),this.$store.dispatch("createSwapper",this.chain),new c.Z(this.from.value).isGreaterThan(this.fromBalance)&&this.$store.dispatch("setTxError","insufficientFunds"),this.error=null,this.approve=null,this.updateQuote(),this.updateQueryParams(),(0,p.F2)(this.to.token?.chain,this.chain)||this.setInitialToken("to"),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token}))}},pendingApprovals:{deep:!0,handler(t){const e=Object.keys(t).length>0;this.isApprovalsPending=e}},quote(t){this.$set(this.to,"value",t?F.Z.withDecimals(t.toTokenAmount,t.toToken.decimals):null)},slippage:{handler(){this.error=null,this.updateQuote(),this.updateQueryParams(),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token})}},swappableTokens:{deep:!0,handler(){this.timesSwappableTokensUpdated+=1}},"to.token":{deep:!0,handler(){this.error=null,this.updateQuote(),this.updateQueryParams(),this.$store.commit("SET_CURRENT_SWAP",{fromToken:this.from.token,toToken:this.to.token})}}},beforeDestroy(){this.$store.dispatch("clearTxError"),clearInterval(this.interval)},created(){x.Z.sendStatsEvent(x.Z.types.IMPRESSION,"wt_swap_entered"),this.chain=JSON.parse(this.$route.query.chain);const t=this.$route.query.from,e=this.$route.query.to,s=this.$route.query.value||null;this.setInitialToken("from",t,s),this.setInitialToken("to",e),this.currentPendingApprovalHash&&this.updateQuote()},mounted(){this.$store.getters.getTimesLoaded("swappableTokens")||this.$store.dispatch("getSwappableTokens")},methods:{changeSlippage(t){this.slippage=t},async checkApprove(t){if(this.quote&&!this.error){this.loading.approve=!0;try{t?this.swapper.checkApprove({from:this.from,to:this.to},t).then((t=>{this.approve=t})):await this.swapper.swap({from:this.from,slippage:this.slippage,to:this.to}).then((()=>{setTimeout((()=>{Object.keys(this.pendingApprovals).length&&this.$store.dispatch("clearPendingApproval",{chain:this.chain,symbol:this.from.token.symbol})}),5e3),clearInterval(this.interval),this.approve=null})).catch((async t=>(this.$errorReporter.reportError(t),await this.swapper.checkApprove({from:this.from,to:this.to},t).then((t=>{this.approve=t})))))}catch(e){et.error(e),this.$errorReporter.reportError(e),this.error=this.generateSwapErrorText(e),clearInterval(this.interval)}finally{this.loading.approve=!1}}},commenceQuoteUpdate(){if(this.loading.quote)this.pendingApprovals.length&&this.pendingApprovals.find((t=>t.token.address!==this.from.token?.address))&&(clearInterval(this.interval),this.getQuote());else if(clearInterval(this.interval),this.currentPendingApprovalHash){const t=5e3;this.interval=setInterval((()=>{this.getQuote()}),t)}else this.getQuote()},determineTokenAddress(t){if(t)return t.address===r.NA?r.L1:t.address},generateSwapErrorText(t){const e=(t.response?.data?.description??"").toLowerCase();return this.fromSymbol===this.toSymbol?this.$t("errors.swappingTheSameToken"):e.includes("insufficient funds")||e.includes("not enough")?this.$t("errors.generic.insufficientFunds"):e.includes("insufficient liquidity")?this.$t("errors.insufficientLiquidity"):e.includes("cannot estimate")?this.$t("errors.insufficientFunds"):this.$t("errors.generic.unknownError")},getApprove(){this.currentPendingApprovalHash?this.openApprovalDetails():this.isInInvalidState||this.$router.push({name:"ApproveConfirm",params:{approve:this.approve,contract:this.swapper.contract,token:this.from}})},async getQuote(){this.loading.quote=!0;try{const t=await this.swapper.getQuote({from:this.from,to:this.to});this.quote=this.repopulateQuote(t),this.$store.commit("SET_CURRENT_SWAP",this.quote),this.error=null,await this.checkApprove()}catch(t){et.error(t),this.$errorReporter.reportError(t),this.quote=null,this.error=this.generateSwapErrorText(t)}this.loading.quote=!1},async getSwap(){if(!this.isSwapUnavailable){this.loading.swap=!0;try{const t=await this.swapper.swap({from:this.from,slippage:this.slippage,to:this.to});this.next(this.repopulateQuote(t))}catch(t){et.error(t),this.$errorReporter.reportError(t),this.checkApprove(t),this.error=this.generateSwapErrorText(t)}finally{this.loading.swap=!1}}},localizeCurrency:_.Z.localizeCurrency,async next(t){x.Z.sendStatsEvent(x.Z.types.CLICK,"wt_swap_next_suc",{network:this.$store.getters.getNetworkName(this.chain)}),this.$store.commit("SET_CURRENT_SWAP",t);const{chain:e}=this,s=this.slippage;t.tx.chain=e,this.$router.push({name:"SwapConfirm",params:{chain:e,slippageMax:s,swap:t}})},openApprovalDetails(){const t=this.$store.getters.transactionDetailsUrl(this.currentPendingApprovalHash,this.chain);this.$platform.openNewTab(t)},refreshTx(){this.error=null,this.updateQuote()},repopulateQuote(t){return Object.assign({},t,{fromToken:this.from.token,toToken:this.to.token})},setInitialToken(t,e="",s=null){let i=this.$store.getters.getTokenViaSerializedKey(e,this.chain,n.oZ.VISIBLE,!0);if(e&&i)this[t]={token:i,value:s};else{const e="from"===t?"to":"from";i=this.swappableTokens[(0,p.fh)(this.chain)].find((t=>!F.Z.isSameToken(t,this[e].token))),this[t]={token:i,value:s}}},switchTokens(){if(this.isLoading)return;const{from:t,to:e}=this;new c.Z(e.value).gt(F.Z.tokenDecimal(e.token))&&(e.value=new c.Z(F.Z.tokenDecimal(e.token))),this.from=e,this.to=t},updateQueryParams(){const t={};this.from.token&&(this.chain=this.from.token.chain,t.from=this.from.token.address,t.chain=JSON.stringify(this.from.token.chain)),this.from.value&&(t.value=this.from.value),this.to.token&&(t.to=this.to.token.address),this.$router.replace({path:this.$route.path,query:t}).catch((e=>{this.$errorReporter.reportError(e,{extraData:{path:this.$route.path,query:t}})}))},updateQuote:o((function(){if(this.canUpdateQuote)return this.hasQuoteBasis?void this.commenceQuoteUpdate():(this.quote=null,this.loading.quote=!1,void(this.error=null))}),1e3)}},it=st,at=(0,m.Z)(it,i,a,!1,null,null,null),rt=at.exports},571:function(t,e,s){t.exports=s.p+"img/empty_error.6fa940d6.svg"}}]);